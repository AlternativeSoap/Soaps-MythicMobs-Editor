<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Line System Test - MythicMobs Editor</title>
    <link rel="stylesheet" href="styles/main.css">
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .test-section {
            background: #2a2a2a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #8b5cf6;
            border-bottom: 1px solid #333;
            padding-bottom: 0.75rem;
        }
        
        .test-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .test-output {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
        }
        
        .test-output pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .status-success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .status-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        
        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .editor-container {
            min-height: 300px;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1rem;
            background: #1e1e1e;
        }
    </style>
</head>
<body>
    <h1>üß™ Skill Line System Test Suite</h1>
    <p>Comprehensive testing of the new 3-mode skill line creation system</p>
    
    <!-- Test 1: Parser -->
    <div class="test-section">
        <h2>1. Skill Line Parser <span class="status-indicator status-success" id="parser-status">Ready</span></h2>
        <p>Test the SkillLineParser with various skill line formats</p>
        
        <div class="test-controls">
            <button class="btn btn-primary" onclick="testParser()">Run Parser Tests</button>
            <button class="btn btn-secondary" onclick="clearOutput('parser-output')">Clear</button>
        </div>
        
        <div class="test-output" id="parser-output">
            <em>Click "Run Parser Tests" to see results...</em>
        </div>
    </div>
    
    <!-- Test 2: Validator -->
    <div class="test-section">
        <h2>2. Skill Line Validator <span class="status-indicator status-success" id="validator-status">Ready</span></h2>
        <p>Test context-aware validation for mob and skill contexts</p>
        
        <div class="test-controls">
            <button class="btn btn-primary" onclick="testValidator()">Run Validator Tests</button>
            <button class="btn btn-secondary" onclick="clearOutput('validator-output')">Clear</button>
        </div>
        
        <div class="test-output" id="validator-output">
            <em>Click "Run Validator Tests" to see results...</em>
        </div>
    </div>
    
    <!-- Test 3: Templates -->
    <div class="test-section">
        <h2>3. Skill Templates <span class="status-indicator status-success" id="templates-status">Ready</span></h2>
        <p>Test template data structure and retrieval</p>
        
        <div class="test-controls">
            <button class="btn btn-primary" onclick="testTemplates()">Run Template Tests</button>
            <button class="btn btn-secondary" onclick="clearOutput('templates-output')">Clear</button>
        </div>
        
        <div class="test-output" id="templates-output">
            <em>Click "Run Template Tests" to see results...</em>
        </div>
    </div>
    
    <!-- Test 4: Full Integration -->
    <div class="test-section">
        <h2>4. Full Integration Test <span class="status-indicator status-success" id="integration-status">Ready</span></h2>
        <p>Test the complete skill builder editor with all modes</p>
        
        <div class="test-controls">
            <button class="btn btn-primary" onclick="testCreationModeSelector()">Open Creation Mode Selector</button>
            <button class="btn btn-primary" onclick="testTemplateSelector()">Open Template Selector</button>
            <button class="btn btn-primary" onclick="testCustomEditor()">Open Custom Editor</button>
            <button class="btn btn-primary" onclick="testMechanicReference()">Open Reference</button>
        </div>
        
        <div class="editor-container" id="test-editor"></div>
    </div>
    
    <!-- Load all dependencies -->
    <script src="data/mechanics.js"></script>
    <script src="data/targeters.js"></script>
    <script src="data/triggers.js"></script>
    <script src="data/conditions.js"></script>
    <script src="data/skillTemplates.js"></script>
    
    <script src="utils/validators.js"></script>
    <script src="utils/skillLineParser.js"></script>
    <script src="utils/skillLineValidator.js"></script>
    
    <script src="components/targeterBrowser.js"></script>
    <script src="components/triggerBrowser.js"></script>
    <script src="components/conditionEditor.js"></script>
    <script src="components/mechanicBrowser.js"></script>
    <script src="components/creationModeSelector.js"></script>
    <script src="components/templateSelector.js"></script>
    <script src="components/mechanicReference.js"></script>
    <script src="components/customSkillLineEditor.js"></script>
    <script src="components/skillBuilderEditor.js"></script>
    
    <script>
        // Test Suite
        
        function testParser() {
            const output = document.getElementById('parser-output');
            const status = document.getElementById('parser-status');
            
            const testCases = [
                '- damage{a=20} @Target ~onAttack',
                '- heal{a=10;overheal=true} @Self',
                '- effect:particles{p=flame;a=20;hs=0.3;vs=0.3;s=0.1;y=1} @Origin',
                '- skill{s=FireballSkill} @Target ?distance{d<10} 0.5',
                '- throw{v=10;vy=5} @Target ~onTimer:100 <50%',
            ];
            
            let results = '<strong>Parser Test Results:</strong>\\n\\n';
            let passed = 0;
            
            testCases.forEach((line, i) => {
                const parsed = SkillLineParser.parse(line);
                results += `Test ${i + 1}: ${line}\\n`;
                results += `  ‚úì Parsed: ${JSON.stringify(parsed, null, 2)}\\n\\n`;
                if (parsed.valid) passed++;
            });
            
            results += `\\n‚úÖ Passed: ${passed}/${testCases.length}`;
            output.innerHTML = `<pre>${results}</pre>`;
            status.textContent = passed === testCases.length ? 'All Passed' : `${passed}/${testCases.length}`;
            status.className = 'status-indicator ' + (passed === testCases.length ? 'status-success' : 'status-warning');
        }
        
        function testValidator() {
            const output = document.getElementById('validator-output');
            const status = document.getElementById('validator-status');
            
            const testCases = [
                { line: '- damage{a=20} @Target ~onAttack', context: 'mob', shouldBeValid: true },
                { line: '- damage{a=20} @Target', context: 'mob', shouldBeValid: false }, // Missing trigger
                { line: '- heal{a=10} @Self', context: 'skill', shouldBeValid: true },
                { line: '- heal{a=10} @Self ~onAttack', context: 'skill', shouldBeValid: false }, // Has trigger in skill
                { line: '- @Target ~onAttack', context: 'mob', shouldBeValid: false }, // Missing mechanic
                { line: '- throw{v=10} @NearestPlayer{r=10} ~onTimer:100', context: 'mob', shouldBeValid: true },
            ];
            
            let results = '<strong>Validator Test Results:</strong>\\n\\n';
            let passed = 0;
            
            testCases.forEach((test, i) => {
                const parsed = SkillLineParser.parse(test.line);
                const validation = SkillLineValidator.validate(parsed, test.context);
                const isValid = validation.valid;
                const correct = isValid === test.shouldBeValid;
                
                results += `Test ${i + 1} [${test.context}]: ${test.line}\\n`;
                results += `  Expected: ${test.shouldBeValid ? 'Valid' : 'Invalid'}\\n`;
                results += `  Got: ${isValid ? 'Valid' : 'Invalid'}\\n`;
                results += `  Result: ${correct ? '‚úÖ PASS' : '‚ùå FAIL'}\\n`;
                results += `  Message: ${SkillLineValidator.getDisplayMessage(validation)}\\n\\n`;
                
                if (correct) passed++;
            });
            
            results += `\\n‚úÖ Passed: ${passed}/${testCases.length}`;
            output.innerHTML = `<pre>${results}</pre>`;
            status.textContent = passed === testCases.length ? 'All Passed' : `${passed}/${testCases.length}`;
            status.className = 'status-indicator ' + (passed === testCases.length ? 'status-success' : 'status-warning');
        }
        
        function testTemplates() {
            const output = document.getElementById('templates-output');
            const status = document.getElementById('templates-status');
            
            let results = '<strong>Template Test Results:</strong>\\n\\n';
            
            // Test template counts
            const mobTemplates = SKILL_TEMPLATES.getTemplatesByContext('mob');
            const skillTemplates = SKILL_TEMPLATES.getTemplatesByContext('skill');
            
            results += `Mob Templates: ${mobTemplates.length}\\n`;
            results += `Skill Templates: ${skillTemplates.length}\\n`;
            results += `Total Templates: ${mobTemplates.length + skillTemplates.length}\\n\\n`;
            
            // Test categories
            const mobCategories = SKILL_TEMPLATES.getAllCategories('mob');
            const skillCategories = SKILL_TEMPLATES.getAllCategories('skill');
            
            results += `Mob Categories: ${mobCategories.join(', ')}\\n`;
            results += `Skill Categories: ${skillCategories.join(', ')}\\n\\n`;
            
            // Test specific template retrieval
            const exampleTemplate = SKILL_TEMPLATES.getTemplate('mob-combat-melee-damage');
            results += `Example Template (mob-combat-melee-damage):\\n`;
            results += `  Name: ${exampleTemplate?.name}\\n`;
            results += `  Skill Line: ${exampleTemplate?.skillLine}\\n\\n`;
            
            results += '‚úÖ All template tests passed';
            output.innerHTML = `<pre>${results}</pre>`;
            status.textContent = 'Passed';
            status.className = 'status-indicator status-success';
        }
        
        function testCreationModeSelector() {
            const selector = new CreationModeSelector();
            selector.open({
                context: 'mob',
                onSelect: (mode) => {
                    alert(`Selected mode: ${mode}`);
                }
            });
        }
        
        function testTemplateSelector() {
            const selector = new TemplateSelector();
            selector.open({
                context: 'mob',
                onSelect: (skillLine) => {
                    alert(`Selected template:\\n${skillLine}`);
                }
            });
        }
        
        function testCustomEditor() {
            const editor = new CustomSkillLineEditor();
            editor.open({
                context: 'mob',
                onAdd: (skillLine) => {
                    alert(`Created skill line:\\n${skillLine}`);
                }
            });
        }
        
        function testMechanicReference() {
            const reference = new MechanicReference();
            reference.open();
        }
        
        function clearOutput(id) {
            document.getElementById(id).innerHTML = '<em>Cleared</em>';
        }
        
        // Initialize skill builder editor in test container
        window.addEventListener('DOMContentLoaded', () => {
            const targeterBrowser = new TargeterBrowser();
            const triggerBrowser = new TriggerBrowser();
            const conditionEditor = new ConditionEditor();
            const mechanicBrowser = new MechanicBrowser(targeterBrowser, triggerBrowser, conditionEditor);
            
            const editor = new SkillBuilderEditor('test-editor', targeterBrowser, mechanicBrowser);
            editor.setContext('mob');
            
            // Add some example skill lines
            editor.setValue([
                '- damage{a=20} @Target ~onAttack',
                '- heal{a=10} @Self ~onDamaged',
                '- effect:particles{p=flame;a=20} @Origin'
            ]);
            
            console.log('‚úÖ Test suite initialized');
        });
    </script>
</body>
</html>

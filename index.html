<!DOCTYPE html>
<!--
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Soaps MythicMobs Editor
    Created by: AlternativeSoap
    Â© 2025-2026 AlternativeSoap - All Rights Reserved
    
    This tool is provided as-is for the MythicMobs community.
    Please respect the creator's work and give credit where due.
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Soaps MythicMobs Editor - Create Custom Mobs & Skills</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Free browser-based editor for creating custom MythicMobs configurations. Design mobs, skills, items, and drop tables visually - no coding required. Export ready-to-use YAML files.">
    <meta name="keywords" content="MythicMobs, Minecraft, mob editor, YAML generator, custom mobs, skills editor, Minecraft server, plugin configuration, MythicMobs editor">
    <meta name="author" content="AlternativeSoap">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#8b5cf6">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://editor.soapsuniverse.com/">
    <meta property="og:title" content="Soaps MythicMobs Editor - Create Custom Mobs & Skills">
    <meta property="og:description" content="Free browser-based editor for creating custom MythicMobs configurations. Design mobs, skills, items visually and export ready-to-use YAML files.">
    <meta property="og:image" content="https://editor.soapsuniverse.com/assets/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Soaps MythicMobs Editor">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://editor.soapsuniverse.com/">
    <meta name="twitter:title" content="Soaps MythicMobs Editor - Create Custom Mobs & Skills">
    <meta name="twitter:description" content="Free browser-based editor for creating custom MythicMobs configurations. Design mobs, skills, items visually.">
    <meta name="twitter:image" content="https://editor.soapsuniverse.com/assets/og-image.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://editor.soapsuniverse.com/">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MythicMobs Editor">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Font Awesome (with SRI integrity) -->
    <link rel="stylesheet" 
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
          crossorigin="anonymous" 
          referrerpolicy="no-referrer">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles/main.css?v=20260103j">
    <link rel="stylesheet" href="styles/mode-comparison.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/editor.css">
    <link rel="stylesheet" href="styles/browser-modal.css">
    <link rel="stylesheet" href="styles/conditionBrowser.css">
    <link rel="stylesheet" href="styles/triggerBrowser.css">
    <link rel="stylesheet" href="styles/packImporter.css">
    <link rel="stylesheet" href="styles/skillLineBuilder.css">
    <link rel="stylesheet" href="styles/mechanicBrowser.css">
    <link rel="stylesheet" href="styles/placeholderBrowser.css">
    <link rel="stylesheet" href="styles/variableBrowser.css">
    <link rel="stylesheet" href="styles/variableBuilder.css">
    <link rel="stylesheet" href="styles/mobVariablesEditor.css">
    <link rel="stylesheet" href="styles/spawnerEditor.css">
    <link rel="stylesheet" href="styles/statsEditor.css">
    <link rel="stylesheet" href="styles/adminPanel.css">
    <link rel="stylesheet" href="styles/adminPanelEnhanced.css?v=20260113">
    <link rel="stylesheet" href="styles/templateWizard.css">
    <link rel="stylesheet" href="styles/browser-management.css">
    <link rel="stylesheet" href="styles/pack-tools.css">
    <link rel="stylesheet" href="styles/totemBuilder.css">
    <link rel="stylesheet" href="styles/guidedMode.css">
    
    <!-- Mobile Support Styles -->
    <link rel="stylesheet" href="styles/mobile.css">
    <link rel="stylesheet" href="styles/mobileSkillWizard.css">
</head>
<body>
    <!-- Main Container -->
    <div id="app" class="app-container">
        
        <!-- Top Header Bar -->
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">
                    <i class="fas fa-dragon"></i>
                    Soaps MythicMobs Editor
                </h1>
                <div class="mode-switcher" role="group" aria-label="Editor mode selection">
                    <button class="mode-btn" data-mode="guided" title="Step-by-step wizards for absolute beginners" aria-label="Switch to Guided mode - step-by-step wizards for beginners">
                        <i class="fas fa-wand-magic-sparkles" aria-hidden="true"></i> Guided
                    </button>
                    <button class="mode-btn active" data-mode="beginner" title="Shows essential MythicMobs features - perfect for getting started" aria-label="Switch to Beginner mode - essential features" aria-pressed="true">
                        <i class="fas fa-user" aria-hidden="true"></i> Beginner
                    </button>
                    <button class="mode-btn" data-mode="advanced" title="Enables all MythicMobs features and advanced options" aria-label="Switch to Advanced mode - all features">
                        <i class="fas fa-user-cog" aria-hidden="true"></i> Advanced
                        <i class="fas fa-info-circle mode-info-icon" id="mode-info-icon" title="What's included in Advanced mode?" aria-hidden="true"></i>
                    </button>
                    <button class="mode-difference-link" id="mode-difference-btn" title="Compare Guided, Beginner and Advanced modes" aria-label="Compare editor modes">
                        <i class="fas fa-question-circle" aria-hidden="true"></i> What's the difference?
                    </button>
                </div>
            </div>
            <div class="header-right">
                <!-- Unified Save/Sync Status Container -->
                <div class="unified-save-container">
                    <!-- Cloud Sync Indicator (small icon) -->
                    <div class="sync-indicator" id="sync-indicator" title="Cloud sync status">
                        <i class="fas fa-cloud"></i>
                    </div>
                    
                    <!-- Main Save Status -->
                    <div class="save-status-container">
                        <div class="save-status saved" id="save-status" title="Click to view details">
                            <i class="fas fa-check-circle"></i>
                            <span>All Saved</span>
                        </div>
                        <div class="recent-changes-dropdown hidden" id="recent-changes-dropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-title">
                                    <h4>Save Status</h4>
                                    <span class="sync-badge" id="sync-badge">
                                        <i class="fas fa-cloud"></i>
                                        <span>Synced</span>
                                    </span>
                                </div>
                            </div>
                            <div class="dropdown-content" id="recent-changes-list">
                                <div class="no-changes">
                                    <i class="fas fa-check-circle"></i>
                                    <span>All changes saved</span>
                                </div>
                            </div>
                            <div class="dropdown-footer">
                                <button class="btn btn-sm btn-primary" id="dropdown-save-all-btn">
                                    <i class="fas fa-save"></i> Save All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="save-all-btn" title="Save all modified files (Ctrl+Shift+S)" aria-label="Save all modified files">
                    <i class="fas fa-save" aria-hidden="true"></i> Save All
                </button>
                
                <!-- User Account -->
                <div class="user-account" id="user-account">
                    <button class="icon-btn user-account-btn" id="user-account-btn" title="Account" aria-label="Open account menu" aria-haspopup="true">
                        <span class="user-avatar" data-user-avatar style="display: flex; align-items: center; justify-content: center; width: 24px; height: 24px;">
                            <i class="fas fa-user-circle" style="font-size: 1.5em;"></i>
                        </span>
                    </button>
                    <div class="user-dropdown" id="user-dropdown">
                        <div class="user-info" id="user-info">
                            <span class="user-info-avatar" data-user-avatar style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px;">
                                <i class="fas fa-user-circle" style="font-size: 2em; color: var(--primary);"></i>
                            </span>
                            <div>
                                <div class="user-email" id="user-email">Not signed in</div>
                                <div class="user-type" id="user-type">Anonymous User</div>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <button class="btn btn-secondary" id="syncToCloudBtn" style="display: none;">
                            <i class="fas fa-cloud-upload-alt"></i> Sync to Cloud
                        </button>
                        <button class="btn btn-secondary" id="loginBtn">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                        <button class="btn btn-secondary" id="logoutBtn" style="display: none;">
                            <i class="fas fa-sign-out-alt"></i> Sign Out
                        </button>
                    </div>
                </div>
                
                <!-- Tools Menu -->
                <div class="tools-menu advanced-only">
                    <button class="icon-btn" id="tools-btn" title="Tools" aria-label="Open tools menu" aria-haspopup="true">
                        <i class="fas fa-wrench"></i>
                    </button>
                    <div class="tools-dropdown" id="tools-dropdown">
                        <div class="tools-dropdown-item" data-tool="statistics">
                            <i class="fas fa-chart-bar"></i>
                            <div class="item-label">
                                <div class="item-text">Pack Statistics</div>
                                <span class="item-description">Analytics & metrics</span>
                            </div>
                        </div>
                        
                        <div class="tools-dropdown-item" data-tool="dependency">
                            <i class="fas fa-project-diagram"></i>
                            <div class="item-label">
                                <div class="item-text">Dependency Graph</div>
                                <span class="item-description">Ctrl+Shift+D</span>
                            </div>
                        </div>
                        
                        <div class="tools-dropdown-divider"></div>
                        
                        <div class="tools-dropdown-item" data-tool="duplicates">
                            <i class="fas fa-clone"></i>
                            <div class="item-label">
                                <div class="item-text">Duplicate Detector</div>
                                <span class="item-description">Find conflicts</span>
                            </div>
                        </div>
                        
                        <div class="tools-dropdown-item" data-tool="validator">
                            <i class="fas fa-check-circle"></i>
                            <div class="item-label">
                                <div class="item-text">Pack Validator</div>
                                <span class="item-description">Health check</span>
                            </div>
                        </div>
                        
                        <div class="tools-dropdown-item" data-tool="usage">
                            <i class="fas fa-chart-line"></i>
                            <div class="item-label">
                                <div class="item-text">Skill Usage Report</div>
                                <span class="item-description">Usage analytics</span>
                            </div>
                        </div>
                        
                        <div class="tools-dropdown-divider"></div>
                        
                        <div class="tools-dropdown-item" data-tool="backup">
                            <i class="fas fa-save"></i>
                            <div class="item-label">
                                <div class="item-text">Backup Manager</div>
                                <span class="item-description">Save & restore</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="icon-btn" id="settings-btn" title="Settings" aria-label="Open settings" aria-haspopup="dialog">
                    <i class="fas fa-cog" aria-hidden="true"></i>
                </button>
                <button class="icon-btn" id="help-btn" title="Help" aria-label="Open help documentation" aria-haspopup="dialog">
                    <i class="fas fa-question-circle" aria-hidden="true"></i>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="app-content">
            
            <!-- Left Sidebar - File Tree -->
            <aside class="sidebar sidebar-left" id="sidebar-left">
                <div class="sidebar-header">
                    <h3><i class="fas fa-folder-tree"></i> Packs</h3>
                    <div class="header-actions">
                        <button class="icon-btn" id="new-pack-btn" title="New Pack" aria-label="Create new pack">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="icon-btn" id="toggle-left-sidebar" title="Hide File Tree" aria-label="Toggle file tree sidebar">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>
                </div>
                <div class="sidebar-content">
                    <!-- Search Box -->
                    <div class="pack-search-container">
                        <div class="search-input-wrapper">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" 
                                   id="pack-search-input" 
                                   class="pack-search-input" 
                                   placeholder="Search files..."
                                   autocomplete="off">
                            <button class="icon-btn search-clear-btn hidden" id="pack-search-clear" title="Clear search" aria-label="Clear search">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Recent Files Section -->
                    <div class="recent-files-section collapsed" id="recent-files-section">
                        <div class="recent-files-header" id="recent-files-header">
                            <i class="fas fa-chevron-right recent-chevron"></i>
                            <i class="fas fa-clock"></i>
                            <span>Recent Files</span>
                            <span class="badge" id="recent-files-count">0</span>
                            <button class="clear-all-btn" id="clear-recent-files-btn" title="Clear all recent files">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="recent-files-list" id="recent-files-list"></div>
                    </div>
                    
                    <!-- Favorites Section -->
                    <div class="favorites-section collapsed" id="favorites-section">
                        <div class="favorites-header" id="favorites-header">
                            <i class="fas fa-chevron-right favorites-chevron"></i>
                            <i class="fas fa-star"></i>
                            <span>Favorites</span>
                            <span class="badge" id="favorites-count">0</span>
                            <button class="clear-all-btn" id="clear-favorites-btn" title="Clear all favorites">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="favorites-list" id="favorites-list"></div>
                    </div>
                    
                    <!-- Pack Tree -->
                    <div class="pack-tree-header">
                        <span>Packs</span>
                        <div class="pack-tree-actions">
                            <button class="icon-btn" id="refresh-tree-btn" title="Refresh File Tree">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="icon-btn" id="expand-all-btn" title="Expand All">
                                <i class="fas fa-angle-double-down"></i>
                            </button>
                            <button class="icon-btn" id="collapse-all-btn" title="Collapse All">
                                <i class="fas fa-angle-double-up"></i>
                            </button>
                        </div>
                    </div>
                    <div id="pack-tree"></div>
                </div>
                <div class="sidebar-footer">
                    <button class="btn btn-secondary btn-sm" id="import-pack-btn">
                        <i class="fas fa-file-import"></i> Import Pack
                    </button>
                    <div style="text-align: center; padding: 8px; font-size: 11px; color: var(--text-tertiary); opacity: 0.7;">
                        Made with ðŸ’œ by <strong>AlternativeSoap</strong>
                    </div>
                </div>
            </aside>

            <!-- Left Sidebar Collapsed Strip -->
            <div class="sidebar-collapsed-strip sidebar-collapsed-left hidden" id="sidebar-left-collapsed">
                <button class="icon-btn" id="expand-left-sidebar" title="Show File Tree" aria-label="Show file tree sidebar">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Resize Handle -->
            <div class="resize-handle" id="resize-left" data-direction="horizontal"></div>

            <!-- Center Panel - Editor -->
            <main class="editor-panel">
                <!-- Breadcrumb Navigation -->
                <div class="breadcrumb" id="breadcrumb">
                    <button class="breadcrumb-home" id="breadcrumb-home" title="Back to Dashboard (ESC)">
                        <i class="fas fa-home"></i>
                    </button>
                    <span class="breadcrumb-item">Dashboard</span>
                </div>

                <!-- Editor Content -->
                <div class="editor-content" id="editor-content">
                    <!-- Dashboard (Default View) -->
                    <div id="dashboard-view" class="view-container active">
                        <div class="dashboard-container">
                            <!-- Smart Welcome Bar -->
                            <div class="dashboard-welcome">
                                <div class="welcome-left">
                                    <div class="welcome-icon"><i class="fas fa-dragon"></i></div>
                                    <div class="welcome-text">
                                        <h1>Welcome back</h1>
                                        <p class="welcome-stats" id="dashboard-pack-summary">Loading your workspace...</p>
                                    </div>
                                </div>
                                <div class="welcome-right">
                                    <button class="dashboard-cmd-btn" id="dashboard-cmd-palette" title="Command Palette">
                                        <i class="fas fa-terminal"></i>
                                        <span>Command Palette</span>
                                        <span class="cmd-shortcut"><kbd>Ctrl</kbd><kbd>K</kbd></span>
                                    </button>
                                </div>
                            </div>

                            <!-- Recent Files Section (dynamic) -->
                            <div class="dashboard-recent-section hidden" id="dashboard-recent-section">
                                <div class="dashboard-section-bar">
                                    <h2><i class="fas fa-clock-rotate-left"></i> Continue Working</h2>
                                </div>
                                <div class="recent-files-row" id="dashboard-recent-files"></div>
                            </div>

                            <!-- Pack Stats Bar -->
                            <div class="dashboard-stats-bar" id="dashboard-stats-bar">
                                <div class="dash-stat" data-type="mob">
                                    <i class="fas fa-skull"></i>
                                    <span class="dash-stat-num" id="dash-stat-mobs">0</span>
                                    <span class="dash-stat-label">Mobs</span>
                                </div>
                                <div class="dash-stat" data-type="skill">
                                    <i class="fas fa-magic"></i>
                                    <span class="dash-stat-num" id="dash-stat-skills">0</span>
                                    <span class="dash-stat-label">Skills</span>
                                </div>
                                <div class="dash-stat" data-type="item">
                                    <i class="fas fa-gem"></i>
                                    <span class="dash-stat-num" id="dash-stat-items">0</span>
                                    <span class="dash-stat-label">Items</span>
                                </div>
                                <div class="dash-stat" data-type="droptable">
                                    <i class="fas fa-dice"></i>
                                    <span class="dash-stat-num" id="dash-stat-droptables">0</span>
                                    <span class="dash-stat-label">DropTables</span>
                                </div>
                                <div class="dash-stat" data-type="pack">
                                    <i class="fas fa-box"></i>
                                    <span class="dash-stat-num" id="dash-stat-packs">0</span>
                                    <span class="dash-stat-label">Packs</span>
                                </div>
                            </div>

                            <!-- Primary Create Actions -->
                            <div class="dashboard-section">
                                <div class="dashboard-section-bar">
                                    <h2><i class="fas fa-plus-circle"></i> Create New</h2>
                                </div>
                                <div class="create-primary-grid">
                                    <button class="create-card create-card-mob" id="quick-new-mob">
                                        <div class="create-card-icon"><i class="fas fa-skull"></i></div>
                                        <div class="create-card-body">
                                            <h3>New Mob</h3>
                                            <p>Custom mob with abilities</p>
                                        </div>
                                        <span class="create-shortcut"><kbd>Ctrl</kbd><kbd>N</kbd></span>
                                    </button>
                                    <button class="create-card create-card-skill" id="quick-new-skill">
                                        <div class="create-card-icon"><i class="fas fa-magic"></i></div>
                                        <div class="create-card-body">
                                            <h3>New Skill</h3>
                                            <p>Powerful skill mechanics</p>
                                        </div>
                                        <span class="create-shortcut"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>M</kbd></span>
                                    </button>
                                    <button class="create-card create-card-item" id="quick-new-item">
                                        <div class="create-card-icon"><i class="fas fa-gem"></i></div>
                                        <div class="create-card-body">
                                            <h3>New Item</h3>
                                            <p>Custom items & gear</p>
                                        </div>
                                        <span class="create-shortcut"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>I</kbd></span>
                                    </button>
                                    <button class="create-card create-card-droptable" id="quick-new-droptable">
                                        <div class="create-card-icon"><i class="fas fa-dice"></i></div>
                                        <div class="create-card-body">
                                            <h3>New DropTable</h3>
                                            <p>Loot & reward tables</p>
                                        </div>
                                        <span class="create-shortcut"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>T</kbd></span>
                                    </button>
                                </div>
                            </div>

                            <!-- Secondary Actions -->
                            <div class="dashboard-section">
                                <div class="dashboard-secondary-grid">
                                    <button class="secondary-action" id="quick-template-browser">
                                        <i class="fas fa-box-open"></i>
                                        <span>From Template</span>
                                        <kbd>Ctrl+Shift+B</kbd>
                                    </button>
                                    <button class="secondary-action advanced-only" id="quick-new-randomspawn">
                                        <i class="fas fa-map-marked-alt"></i>
                                        <span>Random Spawn</span>
                                        <kbd>Ctrl+Shift+R</kbd>
                                    </button>
                                    <button class="secondary-action advanced-only" id="quick-new-spawner">
                                        <i class="fas fa-dungeon"></i>
                                        <span>Spawner</span>
                                        <kbd>Ctrl+Shift+P</kbd>
                                    </button>
                                    <button class="secondary-action advanced-only" id="quick-placeholder-browser">
                                        <i class="fas fa-code"></i>
                                        <span>Placeholders</span>
                                        <kbd>Ctrl+Shift+H</kbd>
                                    </button>
                                    <button class="secondary-action advanced-only" id="quick-stats-editor">
                                        <i class="fas fa-chart-line"></i>
                                        <span>Stats Editor</span>
                                        <kbd>Ctrl+Shift+A</kbd>
                                    </button>
                                    <button class="secondary-action advanced-only" id="quick-import">
                                        <i class="fas fa-file-import"></i>
                                        <span>Import YAML</span>
                                        <kbd>Ctrl+Shift+O</kbd>
                                    </button>
                                </div>
                            </div>

                            <!-- Contextual Quick Start (dynamic) -->
                            <div class="dashboard-quickstart" id="dashboard-quickstart"></div>
                        </div>
                    </div>

                    <!-- Guided Mode Dashboard (placed first to appear at top when in guided mode) -->
                    <div id="guided-mode-dashboard" class="view-container guided-only"></div>

                    <!-- Mob Editor View -->
                    <div id="mob-editor-view" class="view-container"></div>

                    <!-- Skill Editor View -->
                    <div id="skill-editor-view" class="view-container"></div>

                    <!-- Item Editor View -->
                    <div id="item-editor-view" class="view-container"></div>

                    <!-- DropTable Editor View -->
                    <div id="droptable-editor-view" class="view-container"></div>

                    <!-- RandomSpawn Editor View -->
                    <div id="randomspawn-editor-view" class="view-container"></div>

                    <!-- Spawner Editor View -->
                    <div id="spawner-editor-view" class="view-container"></div>

                    <!-- PackInfo Editor View -->
                    <div id="packinfo-editor-view" class="view-container"></div>

                    <!-- Stats Editor View -->
                    <div id="stats-editor-view" class="view-container"></div>
                </div>
            </main>

            <!-- Resize Handle -->
            <div class="resize-handle" id="resize-right" data-direction="horizontal"></div>

            <!-- Right Sidebar - YAML Preview -->
            <aside class="sidebar sidebar-right" id="sidebar-right">
                <div class="sidebar-header">
                    <h3><i class="fas fa-code"></i> YAML Preview</h3>
                    <div class="header-actions">
                        <button class="icon-btn" id="copy-yaml-btn" title="Copy YAML" aria-label="Copy YAML to clipboard">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="icon-btn" id="toggle-right-sidebar" title="Toggle Sidebar" aria-label="Toggle YAML preview sidebar">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="sidebar-content">
                    <pre class="yaml-preview" id="yaml-preview-content" contenteditable="true" spellcheck="false"><code># Select an item to see YAML preview</code></pre>
                </div>
                <div class="sidebar-footer">
                    <button class="btn btn-primary btn-sm" id="export-yaml-btn">
                        <i class="fas fa-download"></i> Export YAML
                    </button>
                </div>
            </aside>

            <!-- Right Sidebar Collapsed Strip -->
            <div class="sidebar-collapsed-strip sidebar-collapsed-right hidden" id="sidebar-right-collapsed">
                <button class="icon-btn" id="expand-right-sidebar" title="Show YAML Preview" aria-label="Show YAML preview sidebar">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Site Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-main">
                <div class="footer-copyright">
                    <span>Â© <span id="copyright-year">2025</span> AlternativeSoap Â· All Rights Reserved</span>
                    <span class="footer-divider">Â·</span>
                    <span class="footer-version" id="app-version" title="Version">v2.5.0</span>
                </div>
                <div class="footer-links">
                    <a href="#" id="footer-terms-link">Terms of Service</a>
                    <span class="footer-divider">Â·</span>
                    <a href="#" id="footer-license-link">License</a>
                    <span class="footer-divider">Â·</span>
                    <a href="#" id="footer-privacy-link">Privacy</a>
                    <span class="footer-divider">Â·</span>
                    <a href="#" id="footer-disclaimer-link">Disclaimer</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Legal Modal: Terms of Service -->
    <div class="legal-modal-overlay hidden" id="terms-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="terms-modal-title">
        <div class="legal-modal">
            <div class="legal-modal-header">
                <h2 id="terms-modal-title"><i class="fas fa-file-contract" aria-hidden="true"></i> Terms of Service</h2>
                <button class="legal-modal-close" data-modal="terms-modal-overlay" aria-label="Close Terms of Service">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="legal-modal-body">
                <p class="legal-effective-date">Effective Date: January 1, 2025</p>
                
                <h3>1. Acceptance of Terms</h3>
                <p>By accessing or using Soaps MythicMobs Editor ("Soap's Editor"), you agree to be bound by these Terms of Service. If you do not agree to these terms, please do not use Soap's Editor.</p>
                
                <h3>2. Service Description</h3>
                <p>Soaps MythicMobs Editor is a free, browser-based configuration editor that generates YAML files compatible with the MythicMobs plugin for Minecraft servers. Soap's Editor is provided as a convenience to the community.</p>
                
                <h3>3. No Warranty</h3>
                <p>SOAP'S EDITOR IS PROVIDED "AS-IS" WITHOUT ANY WARRANTIES OF ANY KIND, EXPRESS OR IMPLIED. This includes, but is not limited to, warranties of merchantability, fitness for a particular purpose, and non-infringement.</p>
                
                <h3>4. Limitation of Liability</h3>
                <p>In no event shall AlternativeSoap or contributors be liable for any direct, indirect, incidental, special, consequential, or punitive damages arising from:</p>
                <ul>
                    <li>Use or inability to use Soap's Editor</li>
                    <li>Any errors in generated configuration files</li>
                    <li>Data loss or corruption</li>
                    <li>Server issues resulting from use of generated files</li>
                    <li>Any other damages related to Soap's Editor</li>
                </ul>
                
                <h3>5. User Responsibility</h3>
                <p>Users are solely responsible for:</p>
                <ul>
                    <li>Validating all generated configuration output before use</li>
                    <li>Testing configurations in a safe environment first</li>
                    <li>Backing up existing server data before applying changes</li>
                    <li>Ensuring compliance with their server hosting terms</li>
                </ul>
                
                <h3>6. Service Availability</h3>
                <p>Soap's Editor is provided free of charge. We reserve the right to modify, suspend, or discontinue the service at any time without prior notice.</p>
                
                <h3>7. Changes to Terms</h3>
                <p>These terms may be updated at any time. Continued use of Soap's Editor after changes constitutes acceptance of the new terms.</p>
            </div>
            <div class="legal-modal-footer">
                <button class="btn btn-primary legal-modal-close-btn" data-modal="terms-modal-overlay">I Understand</button>
            </div>
        </div>
    </div>

    <!-- Legal Modal: License -->
    <div class="legal-modal-overlay hidden" id="license-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="license-modal-title">
        <div class="legal-modal">
            <div class="legal-modal-header">
                <h2 id="license-modal-title"><i class="fas fa-balance-scale" aria-hidden="true"></i> License</h2>
                <button class="legal-modal-close" data-modal="license-modal-overlay" aria-label="Close License">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="legal-modal-body">
                <h3>Usage Rights</h3>
                <p>Soaps MythicMobs Editor is <strong>free to use</strong> for both personal and commercial purposes. You may use Soap's Editor to create configurations for any Minecraft server, whether for personal enjoyment or commercial server operations.</p>
                
                <h3>Intellectual Property</h3>
                <p>Soap's Editor, including its design, code, and functionality, remains the intellectual property of <strong>AlternativeSoap</strong>. All rights not explicitly granted are reserved.</p>
                
                <h3>What You May Do</h3>
                <ul>
                    <li><i class="fas fa-check" style="color: var(--success);"></i> Use Soap's Editor for personal projects</li>
                    <li><i class="fas fa-check" style="color: var(--success);"></i> Use Soap's Editor for commercial server configurations</li>
                    <li><i class="fas fa-check" style="color: var(--success);"></i> Share links to Soap's Editor with others</li>
                    <li><i class="fas fa-check" style="color: var(--success);"></i> Use generated YAML output freely</li>
                </ul>
                
                <h3>What You May Not Do</h3>
                <ul>
                    <li><i class="fas fa-times" style="color: var(--error);"></i> Claim ownership of Soap's Editor</li>
                    <li><i class="fas fa-times" style="color: var(--error);"></i> Redistribute Soap's Editor as your own work</li>
                    <li><i class="fas fa-times" style="color: var(--error);"></i> Remove or alter copyright notices</li>
                    <li><i class="fas fa-times" style="color: var(--error);"></i> Sell or sublicense Soap's Editor itself</li>
                </ul>
                
                <h3>No Ownership Transfer</h3>
                <p>Use of Soap's Editor does not grant you any ownership rights. Soap's Editor is licensed, not sold, and remains the property of its creator.</p>
                
                <h3>Attribution</h3>
                <p>While not required, attribution to "Soaps MythicMobs Editor by AlternativeSoap" is appreciated when sharing or discussing Soap's Editor.</p>
            </div>
            <div class="legal-modal-footer">
                <button class="btn btn-primary legal-modal-close-btn" data-modal="license-modal-overlay">Close</button>
            </div>
        </div>
    </div>

    <!-- Legal Modal: Disclaimer -->
    <div class="legal-modal-overlay hidden" id="disclaimer-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="disclaimer-modal-title">
        <div class="legal-modal">
            <div class="legal-modal-header">
                <h2 id="disclaimer-modal-title"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i> Important Disclaimer</h2>
                <button class="legal-modal-close" data-modal="disclaimer-modal-overlay" aria-label="Close Disclaimer">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="legal-modal-body">
                <div class="disclaimer-highlight">
                    <i class="fas fa-shield-alt"></i>
                    <div>
                        <strong>Independent Community Project</strong>
                        <p>This is a third-party, community-made configuration editor created by AlternativeSoap.</p>
                    </div>
                </div>
                
                <h3>No Affiliation</h3>
                <p>Soaps MythicMobs Editor is <strong>NOT</strong>:</p>
                <ul>
                    <li>Owned by the MythicMobs Authors</li>
                    <li>Affiliated with the MythicMobs Authors</li>
                    <li>Endorsed by the MythicMobs Authors</li>
                    <li>Officially supported by the MythicMobs Authors</li>
                </ul>
                
                <h3>No Responsibility</h3>
                <p>The MythicMobs Authors have <strong>no responsibility</strong> for Soap's Editor. They did not create it, do not maintain it, and are not liable for any issues arising from its use.</p>
                
                <div class="disclaimer-warning">
                    <i class="fas fa-ban"></i>
                    <div>
                        <strong>Do Not Contact MythicMobs Authors for Support</strong>
                        <p>Please do not contact the MythicMobs Authors for support, bug reports, or feature requests related to Soap's Editor. They cannot help you with issues regarding this editor.</p>
                    </div>
                </div>
                
                <h3>Trademark Notice</h3>
                <p>"MythicMobs" is referenced in Soap's Editor solely to describe compatibility with the MythicMobs plugin. This reference does not imply any official relationship or endorsement. All trademarks belong to their respective owners.</p>
                
                <h3>Support for Soap's Editor</h3>
                <p>For questions, issues, or feedback about Soaps MythicMobs Editor, please contact AlternativeSoap through the appropriate community channels.</p>
            </div>
            <div class="legal-modal-footer">
                <button class="btn btn-primary legal-modal-close-btn" data-modal="disclaimer-modal-overlay">I Understand</button>
            </div>
        </div>
    </div>

    <!-- Legal Modal: Privacy -->
    <div class="legal-modal-overlay hidden" id="privacy-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="privacy-modal-title">
        <div class="legal-modal">
            <div class="legal-modal-header">
                <h2 id="privacy-modal-title"><i class="fas fa-user-shield" aria-hidden="true"></i> Privacy</h2>
                <button class="legal-modal-close" data-modal="privacy-modal-overlay" aria-label="Close Privacy Policy">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="legal-modal-body">
                <div class="disclaimer-highlight">
                    <i class="fas fa-shield-alt"></i>
                    <div>
                        <strong>Your Privacy Matters</strong>
                        <p>Soap's Editor is designed with your privacy in mind. We do not track you or sell your data.</p>
                    </div>
                </div>
                
                <h3>No Cookies</h3>
                <p>Soap's Editor does <strong>not use cookies</strong>. We do not place any tracking cookies, advertising cookies, or third-party cookies on your device.</p>
                
                <h3>Local Storage</h3>
                <p>Soap's Editor uses your browser's <strong>localStorage</strong> to save:</p>
                <ul>
                    <li><i class="fas fa-folder" style="color: var(--accent-primary);"></i> Your packs, mobs, skills, items, and droptables</li>
                    <li><i class="fas fa-cog" style="color: var(--accent-primary);"></i> Your editor preferences and settings</li>
                    <li><i class="fas fa-star" style="color: var(--accent-primary);"></i> Your favorites and recent files</li>
                    <li><i class="fas fa-columns" style="color: var(--accent-primary);"></i> Panel sizes and UI preferences</li>
                </ul>
                <p>This data <strong>stays on your device</strong> and is never sent to any server unless you explicitly choose to sync.</p>
                
                <h3>Optional Cloud Sync</h3>
                <p>If you choose to create an account and enable cloud sync:</p>
                <ul>
                    <li>Your email address is stored for authentication</li>
                    <li>Your packs and templates are stored on secure servers (Supabase)</li>
                    <li>You can delete your account and data at any time</li>
                </ul>
                <p>Cloud sync is <strong>completely optional</strong>. Soap's Editor works fully offline without an account.</p>
                
                <h3>No Analytics or Tracking</h3>
                <p>Soap's Editor does <strong>not</strong> use:</p>
                <ul>
                    <li><i class="fas fa-times" style="color: var(--error);"></i> Google Analytics or similar tracking services</li>
                    <li><i class="fas fa-times" style="color: var(--error);"></i> Advertising networks</li>
                    <li><i class="fas fa-times" style="color: var(--error);"></i> User behavior tracking</li>
                    <li><i class="fas fa-times" style="color: var(--error);"></i> Fingerprinting techniques</li>
                </ul>
                
                <h3>Third-Party Services</h3>
                <p>Soap's Editor loads resources from:</p>
                <ul>
                    <li><strong>Google Fonts</strong> â€” For typography (Inter, JetBrains Mono)</li>
                    <li><strong>Font Awesome CDN</strong> â€” For icons</li>
                    <li><strong>Supabase</strong> â€” For optional cloud sync and authentication</li>
                </ul>
                <p>These services have their own privacy policies.</p>
                
                <h3>Your Rights</h3>
                <p>You have full control over your data:</p>
                <ul>
                    <li><i class="fas fa-check" style="color: var(--success);"></i> Clear localStorage anytime via browser settings</li>
                    <li><i class="fas fa-check" style="color: var(--success);"></i> Export your packs before clearing data</li>
                    <li><i class="fas fa-check" style="color: var(--success);"></i> Delete your cloud account if registered</li>
                    <li><i class="fas fa-check" style="color: var(--success);"></i> Use the editor without any account</li>
                </ul>
            </div>
            <div class="legal-modal-footer">
                <button class="btn btn-primary legal-modal-close-btn" data-modal="privacy-modal-overlay">Close</button>
            </div>
        </div>
    </div>

    <!-- Modal Container -->
    <div id="modal-container"></div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Command Palette -->
    <div id="command-palette" class="command-palette hidden">
        <div class="command-palette-content">
            <input type="text" id="command-input" placeholder="Type a command or 'help' for shortcuts..." autocomplete="off">
            <div id="command-results">
                <div class="command-hint">
                    <i class="fas fa-lightbulb"></i>
                    <span>Try typing <strong>help</strong> to see all keyboard shortcuts</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="context-menu" class="context-menu hidden"></div>

    <!-- Change History Modal -->
    <div id="change-history-modal" class="modal hidden">
        <div class="modal-content change-history-modal">
            <div class="modal-header">
                <h3><i class="fas fa-history"></i> Change History</h3>
                <button class="icon-btn" id="close-history-modal" aria-label="Close change history">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="history-filters">
                    <input type="text" class="form-input" id="history-search" placeholder="Search changes...">
                    <button class="btn btn-sm btn-secondary" id="clear-history-btn">
                        <i class="fas fa-trash"></i> Clear History
                    </button>
                </div>
                <div class="history-list" id="full-history-list">
                    <div class="no-changes">No changes recorded</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <button class="icon-btn" id="close-settings-modal" aria-label="Close settings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general"><i class="fas fa-sliders-h"></i> General</button>
                    <button class="settings-tab" data-tab="editor"><i class="fas fa-code"></i> Editor</button>
                    <button class="settings-tab" data-tab="files"><i class="fas fa-folder"></i> Files</button>
                    <button class="settings-tab" data-tab="history"><i class="fas fa-history"></i> History</button>
                </div>
                
                <div class="settings-content">
                    <!-- General Settings -->
                    <div class="settings-panel active" id="settings-general">
                        <div class="settings-group">
                            <div class="settings-group-header">
                                <i class="fas fa-save"></i> Saving
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Auto-save</label>
                                    <span class="setting-description">Save files automatically after changes</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="setting-autosave">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item" id="autosave-interval-container">
                                <div class="setting-info">
                                    <label class="setting-label">Auto-save Interval</label>
                                    <span class="setting-description">Seconds before saving</span>
                                </div>
                                <div class="setting-control">
                                    <input type="range" id="setting-autosave-interval" min="1" max="10" value="2" step="1">
                                    <span class="range-value" id="autosave-interval-value">2s</span>
                                </div>
                            </div>
                        </div>
                        <div class="settings-group">
                            <div class="settings-group-header">
                                <i class="fas fa-palette"></i> Appearance
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Default Mode</label>
                                    <span class="setting-description">Editor mode on startup</span>
                                </div>
                                <div class="setting-control">
                                    <select class="form-select" id="setting-default-mode">
                                        <option value="beginner">Beginner</option>
                                        <option value="guided">Guided</option>
                                        <option value="advanced">Advanced</option>
                                    </select>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Animations</label>
                                    <span class="setting-description">Enable UI animations and transitions</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="setting-animations" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Editor Settings -->
                    <div class="settings-panel" id="settings-editor">
                        <div class="settings-group">
                            <div class="settings-group-header">
                                <i class="fas fa-eye"></i> Preview
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Live YAML Preview</label>
                                    <span class="setting-description">Update preview as you type</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="setting-live-preview" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item" id="preview-delay-container">
                                <div class="setting-info">
                                    <label class="setting-label">Preview Delay</label>
                                    <span class="setting-description">Milliseconds before updating</span>
                                </div>
                                <div class="setting-control">
                                    <input type="range" id="setting-preview-delay" min="100" max="1000" value="300" step="50">
                                    <span class="range-value" id="preview-delay-value">300ms</span>
                                </div>
                            </div>
                        </div>
                        <div class="settings-group">
                            <div class="settings-group-header">
                                <i class="fas fa-pencil-alt"></i> Editing
                            </div>
                            <div class="setting-item advanced-only">
                                <div class="setting-info">
                                    <label class="setting-label">Delay Display</label>
                                    <span class="setting-description">Time unit for delays</span>
                                </div>
                                <div class="setting-control">
                                    <select class="form-select" id="setting-delay-display-mode">
                                        <option value="ticks">Ticks</option>
                                        <option value="seconds">Seconds</option>
                                    </select>
                                </div>
                            </div>
                            <div class="setting-item advanced-only">
                                <div class="setting-info">
                                    <label class="setting-label">Compact Mode</label>
                                    <span class="setting-description">Reduce UI spacing for more content</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="setting-compact-mode">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- File Settings -->
                    <div class="settings-panel" id="settings-files">
                        <div class="settings-group">
                            <div class="settings-group-header">
                                <i class="fas fa-file-alt"></i> File Management
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Warn Duplicate Names</label>
                                    <span class="setting-description">Alert when a file name already exists</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="setting-warn-duplicate-files" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item advanced-only">
                                <div class="setting-info">
                                    <label class="setting-label">Name Separator</label>
                                    <span class="setting-description">Character that replaces spaces in internal names</span>
                                </div>
                                <div class="setting-control">
                                    <select class="form-select" id="setting-internal-name-separator">
                                        <option value="_">_ underscore</option>
                                        <option value="-">- hyphen</option>
                                        <option value=".">. period</option>
                                        <option value="|">| pipe</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- History Settings -->
                    <div class="settings-panel" id="settings-history">
                        <div class="settings-group">
                            <div class="settings-group-header">
                                <i class="fas fa-clock"></i> Change Tracking
                            </div>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <label class="setting-label">Keep History</label>
                                    <span class="setting-description">Track and record file changes</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="setting-keep-history" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item advanced-only" id="max-history-container">
                                <div class="setting-info">
                                    <label class="setting-label">Max Entries</label>
                                    <span class="setting-description">Maximum number of changes to remember</span>
                                </div>
                                <div class="setting-control">
                                    <input type="range" id="setting-max-history" min="50" max="500" value="100" step="50">
                                    <span class="range-value" id="max-history-value">100</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="reset-settings-btn">
                    <i class="fas fa-undo"></i> Reset to Defaults
                </button>
                <button class="btn btn-primary" id="save-settings-btn">
                    <i class="fas fa-check"></i> Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay hidden" id="authModal">
        <div class="modal modal-medium">
            <div class="modal-header">
                <h2 id="auth-modal-title">
                    <i class="fas fa-user-circle"></i> Sign In
                </h2>
                <button class="modal-close" id="auth-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs" id="authTabs">
                    <button class="auth-tab active" id="loginTab" data-tab="login">Sign In</button>
                    <button class="auth-tab" id="signupTab" data-tab="signup">Sign Up</button>
                </div>
                
                <!-- Login Form -->
                <form class="auth-form active" id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="your@email.com" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" autocomplete="current-password" required>
                    </div>
                    <div class="auth-error" id="loginError"></div>
                    <div class="auth-success" id="loginSuccess"></div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                    <a href="#" class="forgot-password" id="forgotPasswordBtn">Forgot password?</a>
                </form>
                
                <!-- Signup Form -->
                <form class="auth-form" id="signupForm">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="signupEmail" placeholder="your@email.com" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="signupPassword" placeholder="Choose a password (min 6 characters)" autocomplete="new-password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" class="form-input" id="confirmPassword" placeholder="Confirm your password" autocomplete="new-password" required minlength="6">
                    </div>
                    <div class="auth-info">
                        <i class="fas fa-info-circle"></i>
                        Your anonymous data will be automatically transferred to your new account.
                    </div>
                    <div class="auth-error" id="signupError"></div>
                    <div class="auth-success" id="signupSuccess"></div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
                
                <!-- Reset Password Form -->
                <form class="auth-form" id="resetPasswordForm">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="resetEmail" placeholder="your@email.com" autocomplete="email" required>
                    </div>
                    <div class="auth-info">
                        <i class="fas fa-info-circle"></i>
                        We'll send you a link to reset your password.
                    </div>
                    <div class="auth-error" id="resetError"></div>
                    <div class="auth-success" id="resetSuccess"></div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="backToLoginBtn">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Send Reset Link
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- External Libraries (with SRI integrity hashes) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" 
            integrity="sha512-XMVd28F1oH/O71fzwBnV7HucLxVwtxf26XV8P4wPk26EDxuGZ91N8bsOttmnomcCD3CS5ZMRL50H0GgOHvegtg==" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js" 
            integrity="sha512-CSBhVREyzHAjAFfBlIBakjoRUKp5h7VSweP0InR/pAJyptH7peuhCsqAI/snV+TwZmXZqoUklpXp6R6wMnYf5Q==" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>

    <!-- Data Files -->
    <script src="data/mobData.js"></script>
    <script src="data/vanillaMobStats.js"></script>
    <script src="data/templates.js"></script>
    <script src="data/entityFieldMap.js"></script>
    <script src="data/minecraftBlocks.js"></script>
    <script src="data/minecraftItems.js"></script>
    <script src="data/minecraftSounds.js"></script>
    <script src="data/damageTypes.js"></script>
    <script src="data/bossBarData.js"></script>
    <script src="data/equipmentData.js"></script>
    <script src="data/aiGoals.js"></script>
    <script src="data/aiTargets.js"></script>
    <script src="data/vanillaOverrides.js"></script>
    <script src="data/powerSystem.js"></script>
    <script src="data/dropTypes.js"></script>
    <script src="data/fancyDrops.js"></script>
    
    <!-- Guided Mode Data -->
    <script src="data/guidedModePresets.js"></script>
    
    <!-- Item Editor Data Files -->
    <script src="data/itemOptions.js"></script>
    <script src="data/enchantments.js"></script>
    <script src="data/potionEffects.js"></script>
    <script src="data/bannerPatterns.js"></script>
    
    <!-- Item Editor Components -->
    <script src="components/bannerRenderer.js"></script>
    
    <!-- Documentation Files -->
    <script src="data/audienceDocumentation.js"></script>
    <script src="data/mathDocumentation.js"></script>
    
    <!-- Conditions System (Load Order Critical) -->
    <script src="data/conditions/conditionActions.js"></script>
    <script src="data/conditions/entityConditions.js"></script>
    <script src="data/conditions/entityConditionsAdvanced.js"></script>
    <script src="data/conditions/locationConditions.js"></script>
    <script src="data/conditions/compareConditions.js"></script>
    <script src="data/conditions/metaConditions.js"></script>
    <script src="data/conditions/metaConditionsAdvanced.js"></script>
    <script src="data/conditions/metaConditionsFinal.js"></script>
    <script src="data/conditions/index.js"></script>

    <!-- Skill System Data (Load Before Components) -->
    <script src="data/targeters.js"></script>
    <script src="data/particleTypes.js"></script>
    <script src="data/mechanics.js"></script>

    <!-- Utility Files -->
    <script src="utils/logger.js"></script>
    <script src="utils/browserPerformance.js"></script>
    <script src="utils/dataStructureOptimizer.js"></script>
    <script src="utils/favoritesManager.js"></script>
    <script src="utils/graphUtils.js"></script>
    <script src="utils/helpers.js"></script>
    <script src="utils/uiEnhancements.js"></script>
    <script src="utils/yamlParser.js"></script>
    <script src="utils/yamlExporter.js"></script>
    <script src="utils/validators.js"></script>
    <script src="utils/skillLineParser.js"></script>
    <script src="utils/skillLineValidator.js"></script>
    <script src="utils/mechanics.js"></script>
    <script src="utils/triggers.js"></script>
    <script src="utils/targeters.js"></script>
    <script src="utils/mobTypes.js"></script>
    <script src="utils/materials.js"></script>
    <script src="utils/editorHistory.js"></script>
    <script src="utils/collapsibleManager.js"></script>
    <script src="utils/panelResizer.js"></script>
    
    <!-- Smart Features -->
    <script src="utils/autocompleteLearning.js"></script>
    <script src="utils/intelligentCacheManager.js"></script>
    <script src="utils/smartDuplicateDetector.js"></script>
    <script src="utils/devicePerformanceDetector.js"></script>
    <script src="utils/smartFavoritesManager.js"></script>
    
    <!-- Performance Optimization -->
    <script src="utils/performanceMonitor.js"></script>

    <!-- Trigger System -->
    <script src="data/triggers.js"></script>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Component Files -->
    <script src="components/supabaseClient.js"></script>
    <script src="components/authManager.js"></script>
    <script src="components/authUI.js"></script>
    <script src="components/storageManager.js"></script>
    <script src="components/contextMenu.js"></script>
    <script src="components/packManager.js"></script>
    <script src="components/fileManager.js"></script>
    <script src="components/documentationHelper.js"></script>
    <script src="components/mobEditor/EntityFieldManager.js"></script>
    
    <!-- Core Systems -->
    <script src="utils/errorLogger.js"></script>
    <script src="utils/activityTracker.js"></script>
    <script src="utils/permissionSystem.js"></script>
    <script src="components/userProfileManager.js"></script>
    
    <!-- Enhanced Dropdown with Categories & Icons -->
    <script src="data/minecraftItemCategories.js"></script>
    <script src="data/minecraftItemIcons.js"></script>
    <script src="components/searchableDropdown.js?v=3.0"></script>
    <script src="components/bossBarEditor.js"></script>
    <script src="components/equipmentEditor.js"></script>
    <script src="components/damageModifierEditor.js"></script>
    <script src="components/aiEditor.js"></script>
    <script src="components/vanillaOverridesEditor.js"></script>
    <script src="components/powerSystemEditor.js"></script>
    
    <script src="components/conditionBrowser.js?v=3.7"></script>
    <script src="components/inlineConditionBuilder.js"></script>
    <script src="components/triggerBrowser.js"></script>
    <script src="components/targeterBrowser.js?v=3.8"></script>
    <script src="components/mechanicBrowser.js"></script>
    <script src="components/skillBrowser.js"></script>
    <script src="data/placeholders.js"></script>
    <script src="data/variableData.js"></script>
    <script src="components/variableManager.js"></script>
    <script src="components/variableBrowser.js"></script>
    <script src="components/variableBuilder.js"></script>
    <script src="components/mobVariablesEditor.js"></script>
    <script src="components/placeholderBrowser.js"></script>
    <script src="components/spawnerEditor.js"></script>
    <script src="components/statsEditor.js"></script>
    <script src="components/creationModeSelector.js"></script>
    <script src="components/notificationModal.js"></script>
    <script src="components/templateManager.js?v=20260102"></script>
    <script src="components/templateImportExport.js"></script>
    <script src="components/templateMigration.js"></script>
    <script src="components/yamlPreviewModal.js"></script>
    <script src="components/browserDataMerger.js"></script>
    <script src="components/browserAdminManager.js"></script>
    <script src="components/attributeBuilder.js"></script>
    <script src="components/adminManager.js"></script>
    <script src="components/adminPanel.js?v=20260102"></script>
    
    <!-- PERFORMANCE: Browser Singleton Manager (MUST load AFTER all browser components) -->
    <script src="utils/browserSingletonManager.js"></script>
    
    <!-- Mode Comparison Modal -->
    <div class="modal hidden" id="mode-comparison-modal" role="dialog" aria-modal="true" aria-labelledby="mode-comparison-title">
        <div class="modal-content mode-comparison-content">
            <div class="modal-header">
                <h2 id="mode-comparison-title"><i class="fas fa-layer-group"></i> Guided vs Beginner vs Advanced Mode</h2>
                <button class="modal-close" id="close-mode-comparison" aria-label="Close comparison">&times;</button>
            </div>
            <div class="modal-body">
                <p class="mode-comparison-intro">Choose the mode that fits your experience level. You can switch anytime!</p>
                
                <div class="mode-comparison-grid three-columns">
                    <!-- Guided Mode Column -->
                    <div class="mode-column guided-column">
                        <div class="mode-column-header">
                            <i class="fas fa-wand-magic-sparkles"></i>
                            <h3>Guided Mode</h3>
                            <span class="mode-badge guided">For Absolute Beginners</span>
                        </div>
                        <div class="mode-column-body">
                            <p class="mode-description">Step-by-step wizards that walk you through creating mobs and skills with helpful explanations.</p>
                            
                            <div class="feature-category">
                                <h4><i class="fas fa-check-circle"></i> Included Features</h4>
                                <ul class="feature-list">
                                    <li><i class="fas fa-hat-wizard"></i> <strong>Step-by-Step Wizards</strong> - Guided creation flows</li>
                                    <li><i class="fas fa-question-circle"></i> <strong>Contextual Help</strong> - Explanations at every step</li>
                                    <li><i class="fas fa-skull"></i> Create Mobs (Wizard-Assisted)</li>
                                    <li><i class="fas fa-magic"></i> Create Skills (Simplified)</li>
                                    <li><i class="fas fa-gem"></i> Create Items (Basic)</li>
                                    <li><i class="fas fa-table"></i> Create Drop Tables</li>
                                    <li><i class="fas fa-lightbulb"></i> <strong>Learning Tips</strong> - Built-in tutorials</li>
                                    <li><i class="fas fa-save"></i> Save & Export YAML</li>
                                </ul>
                            </div>
                            
                            <div class="feature-category">
                                <h4><i class="fas fa-star"></i> Best For</h4>
                                <p class="best-for-text">First-time users who want hand-holding through the creation process.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Beginner Mode Column -->
                    <div class="mode-column beginner-column">
                        <div class="mode-column-header">
                            <i class="fas fa-user"></i>
                            <h3>Beginner Mode</h3>
                            <span class="mode-badge beginner">Recommended Default</span>
                        </div>
                        <div class="mode-column-body">
                            <p class="mode-description">Essential features with a clean interface. No wizards, but straightforward forms.</p>
                            
                            <div class="feature-category">
                                <h4><i class="fas fa-check-circle"></i> Included Features</h4>
                                <ul class="feature-list">
                                    <li><i class="fas fa-skull"></i> Create Mobs (Core Properties)</li>
                                    <li><i class="fas fa-magic"></i> Create Skills (Basic Mechanics)</li>
                                    <li><i class="fas fa-gem"></i> Create Items (Essential Options)</li>
                                    <li><i class="fas fa-table"></i> Create Drop Tables</li>
                                    <li><i class="fas fa-heart"></i> Health & Damage Settings</li>
                                    <li><i class="fas fa-tag"></i> Display Names & Lore</li>
                                    <li><i class="fas fa-shield-alt"></i> Basic Enchantments</li>
                                    <li><i class="fas fa-cube"></i> Basic Attributes</li>
                                    <li><i class="fas fa-save"></i> Save & Export YAML</li>
                                    <li><i class="fas fa-file-import"></i> Import Packs</li>
                                </ul>
                            </div>
                            
                            <div class="feature-category">
                                <h4><i class="fas fa-star"></i> Best For</h4>
                                <p class="best-for-text">Users comfortable with forms who want quick access without clutter.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Mode Column -->
                    <div class="mode-column advanced-column">
                        <div class="mode-column-header">
                            <i class="fas fa-user-cog"></i>
                            <h3>Advanced Mode</h3>
                            <span class="mode-badge advanced">Full Feature Set</span>
                        </div>
                        <div class="mode-column-body">
                            <p class="mode-description">Everything in Beginner mode, plus advanced features and tools for power users.</p>
                            
                            <div class="feature-category">
                                <h4><i class="fas fa-plus-circle"></i> Additional Features</h4>
                                <ul class="feature-list">
                                    <li><i class="fas fa-wrench"></i> <strong>Tools Menu</strong> - Statistics, Dependency Graph</li>
                                    <li><i class="fas fa-history"></i> <strong>Recent Changes</strong> - Edit history</li>
                                    <li><i class="fas fa-map-marked-alt"></i> <strong>RandomSpawn</strong> - Spawn config</li>
                                    <li><i class="fas fa-file-code"></i> <strong>Direct YAML Import</strong></li>
                                    <li><i class="fas fa-crown"></i> <strong>BossBar Settings</strong></li>
                                    <li><i class="fas fa-puzzle-piece"></i> <strong>Modules System</strong></li>
                                    <li><i class="fas fa-bolt"></i> <strong>Power System</strong></li>
                                    <li><i class="fas fa-code"></i> <strong>NBT Data</strong></li>
                                    <li><i class="fas fa-gem"></i> <strong>Crucible Skills</strong></li>
                                    <li><i class="fas fa-filter"></i> <strong>Conditions System</strong></li>
                                    <li><i class="fas fa-cogs"></i> <strong>Advanced Settings</strong></li>
                                </ul>
                            </div>
                            
                            <div class="feature-category">
                                <h4><i class="fas fa-star"></i> Best For</h4>
                                <p class="best-for-text">Experienced users who need full control over all MythicMobs features.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mode-comparison-footer">
                    <p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Start with Guided mode if you're new, or Beginner mode for a clean experience. Switch to Advanced when you need more!</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pack Tools -->
    <script src="components/dependencyGraph.js"></script>
    <script src="components/packStatistics.js"></script>
    <script src="components/duplicateDetector.js"></script>
    <script src="components/packValidator.js"></script>
    <script src="components/skillUsageReport.js"></script>
    <script src="components/backupManager.js"></script>
    
    <script src="components/templateWizard.js"></script>
    <script src="components/templateEditor.js"></script>
    <script src="components/templateSelector.js"></script>
    <script src="components/templateYAMLImporter.js"></script>
    <script src="components/templateImportWizard.js"></script>
    <script src="components/skillLineBuilder.js?v=3.9"></script>
    <script src="components/mechanicReference.js"></script>
    <script src="components/skillLineAutocomplete.js"></script>
    <script src="components/skillLineGroupDetector.js"></script>
    <script src="components/skillLineQuickEdit.js"></script>
    <script src="components/skillLineTooltip.js"></script>
    <script src="components/validationPanel.js"></script>
    <script src="components/skillDependencyTracker.js"></script>
    <script src="components/skillLineFormatter.js"></script>
    <script src="components/skillLineDuplicateDetector.js"></script>
    <script src="components/skillLineSyntaxHighlighter.js"></script>
    <script src="components/keyboardShortcutManager.js"></script>
    <script src="components/historyManager.js"></script>
    <script src="components/onboardingTour.js"></script>
    <script src="utils/performanceUtils.js"></script>
    <script src="utils/lazyLoader.js"></script>
    <script src="utils/workerPool.js"></script>
    <script src="utils/delayAnalyzer.js"></script>
    <!-- virtualScrollManager.js moved up to load BEFORE browsers (line ~875) -->
    <script src="components/skillBuilderEditor.js"></script>
    <script src="components/mobDropsEditor.js"></script>
    <!-- Mob Editor Components -->
    <script src="components/totemRenderer.js"></script>
    <script src="components/mobEditor.js"></script>
    <script src="components/skillEditor.js"></script>
    <script src="components/itemEditor.js"></script>
    <script src="components/droptableEditor.js"></script>
    <script src="components/randomspawnEditor.js"></script>
    <script src="components/yamlEditor.js"></script>
    <script src="components/displayNameBuilder.js"></script>
    <script src="components/commandPalette.js"></script>
    <script src="components/adminPanelEnhanced.js?v=20260113"></script>
    
    <!-- Guided Mode -->
    <script src="components/guidedModeWizard.js"></script>

    <!-- Pack Importer System -->
    <script src="components/packImporter/PackFolderScanner.js"></script>
    <script src="components/packImporter/YamlFileParser.js"></script>
    <script src="components/packImporter/DataValidator.js"></script>
    <script src="components/packImporter/DataValidatorHelpers.js"></script>
    <script src="components/packImporter/ImportPreviewUI.js"></script>
    <script src="components/packImporter/ImportPreviewUIHandlers.js"></script>
    <script src="components/packImporter/ImportExecutor.js"></script>
    <script src="components/packImporter/ImportReportGenerator.js"></script>
    <script src="components/packImporter/PackImporterCore.js"></script>
    
    <!-- Mobile Support System -->
    <script src="utils/mobileManager.js"></script>
    <script src="components/mobileSkillWizard.js"></script>

    <!-- Main Application -->
    <script src="app.js"></script>

    <!-- Initialize -->
    <script>
        // Initialize the application when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize global keyboard shortcut manager
            window.keyboardShortcutManager = new KeyboardShortcutManager();
            
            // Initialize global notification modal
            window.notificationModal = new NotificationModal();
            
            // Initialize global skill line builder (will be updated with dependencies later)
            window.skillLineBuilder = new SkillLineBuilder();
            
            window.editor = new MythicMobsEditor();
            window.editor.init();
            
            // Flag to track if admin system is ready for initialization
            window._adminSystemReady = false;
            window._pendingAdminInit = false;
            
            // Define initializeAdminSystem globally so it can be called from auth listener
            window.initializeAdminSystem = async () => {
                // Only proceed if the template system is ready
                if (!window._adminSystemReady || !window.authManager) {
                    window._pendingAdminInit = true;
                    console.log('â³ Template system not ready, deferring admin initialization...');
                    return;
                }
                
                // Wait for auth to be fully initialized
                let user = window.authManager.getCurrentUser();
                if (!user) {
                    // Auth state may still be loading, wait a bit and check again
                    user = await window.authManager.checkInitialAuth();
                }
                
                if (!user) {
                    console.log('â„¹ï¸ No authenticated user, skipping admin initialization');
                    return;
                }
                
                // Don't reinitialize if already initialized for this user
                if (window.adminManager?.currentUserId === user.id && window.adminManager._uiInitialized) {
                    console.log('â„¹ï¸ Admin system already initialized for this user');
                    return;
                }
                
                // Initialize AdminManager if not already done or for new user
                if (!window.adminManager || window.adminManager.currentUserId !== user.id) {
                    window.adminManager = new AdminManager(window.supabaseClient, window.authManager);
                    await window.adminManager.initialize();
                    window.adminManager.currentUserId = user.id; // Track which user we initialized for
                }
                
                // Create admin panel if user is admin
                if (window.adminManager.isAdmin) {
                    if (!window.adminPanel) {
                        window.adminPanel = new AdminPanel(window.adminManager, window.templateManager, window.authManager);
                        window.adminPanelEnhanced = new AdminPanelEnhanced(window.adminPanel);
                    }
                    
                    // Add admin role label to user-type (replaces email badge to avoid duplication)
                    const userType = document.getElementById('user-type');
                    if (userType) {
                        const role = window.adminManager.getCurrentRole();
                        const roleDisplay = role ? role.replace('_', ' ').toUpperCase() : 'ADMIN';
                        userType.innerHTML = `<i class="fas fa-shield-alt" style="color: #ffd700;"></i> ${roleDisplay}`;
                    }
                    
                    // Add admin panel button to user dropdown
                    const userDropdown = document.getElementById('user-dropdown');
                    const loginBtn = document.getElementById('loginBtn');
                    if (userDropdown && loginBtn && window.authManager?.isAuthenticated()) {
                        // Check if buttons already exist (avoid duplicates)
                        if (!userDropdown.querySelector('.profile-btn')) {
                            // Add Profile button (only for authenticated users)
                            const profileBtn = document.createElement('button');
                            profileBtn.className = 'btn btn-secondary profile-btn';
                            profileBtn.style.marginBottom = '10px';
                            profileBtn.innerHTML = `<i class="fas fa-user"></i> Edit Profile`;
                            profileBtn.onclick = () => window.userProfileManager?.showProfileEditor();
                            userDropdown.insertBefore(profileBtn, loginBtn);
                        }
                        
                        if (!userDropdown.querySelector('.admin-panel-btn')) {
                            // Add Admin Panel button
                            const adminBtn = document.createElement('button');
                            adminBtn.className = 'btn btn-primary admin-panel-btn';
                            adminBtn.style.marginBottom = '10px';
                            adminBtn.innerHTML = `<i class="fas fa-shield-alt"></i> Admin Panel`;
                            adminBtn.onclick = () => window.adminPanel.open();
                            
                            // Insert before login button
                            userDropdown.insertBefore(adminBtn, loginBtn);
                            console.log('âœ… Admin Panel button added to dropdown');
                        }
                    }
                    
                    // Mark UI as initialized
                    window.adminManager._uiInitialized = true;
                } else {
                    // Add profile button for non-admin authenticated users
                    const userDropdown = document.getElementById('user-dropdown');
                    const loginBtn = document.getElementById('loginBtn');
                    if (userDropdown && loginBtn && window.authManager?.isAuthenticated()) {
                        // Check if button already exists
                        if (!userDropdown.querySelector('.profile-btn')) {
                            const profileBtn = document.createElement('button');
                            profileBtn.className = 'btn btn-secondary profile-btn';
                            profileBtn.style.marginBottom = '10px';
                            profileBtn.innerHTML = `<i class="fas fa-user"></i> Edit Profile`;
                            profileBtn.onclick = () => window.userProfileManager?.showProfileEditor();
                            userDropdown.insertBefore(profileBtn, loginBtn);
                        }
                    }
                }
            };
            
            // Clean up admin UI function
            window.cleanupAdminUI = () => {
                // Remove admin panel button if it exists
                const adminBtn = document.querySelector('.admin-panel-btn');
                if (adminBtn) adminBtn.remove();
                
                // Remove profile button if it exists
                const profileBtn = document.querySelector('.profile-btn');
                if (profileBtn) profileBtn.remove();
                
                // Reset user type badge
                const userType = document.getElementById('user-type');
                if (userType) {
                    userType.innerHTML = 'Anonymous';
                }
                
                // Clear admin references
                window.adminManager = null;
                window.adminPanel = null;
                window.adminPanelEnhanced = null;
            };
            
            // Set up early auth listener (BEFORE setTimeout) to catch INITIAL_SESSION
            // This listener will be active immediately when the auth manager is ready
            const setupEarlyAuthListener = () => {
                if (!window.editor?.authManager) {
                    // authManager not ready yet, retry in 50ms
                    setTimeout(setupEarlyAuthListener, 50);
                    return;
                }
                
                // Deduplication: Supabase fires both INITIAL_SESSION and SIGNED_IN for the
                // same user on page load. Track the last processed user ID so we only
                // call initializeAdminSystem once per actual login.
                let _lastAuthInitUserId = null;

                window.editor.authManager.onAuthChange((event, session) => {
                    // Mask email for privacy in console (show only first 2 chars + domain)
                    const maskedEmail = session?.user?.email 
                        ? session.user.email.replace(/^(.{2})[^@]*(@.*)$/, '$1***$2')
                        : 'no user';
                    console.log(`ðŸ” Auth event: ${event}`, maskedEmail);
                    
                    // Initialize on any event that provides a valid session
                    if ((event === 'SIGNED_IN' || event === 'INITIAL_SESSION' || event === 'TOKEN_REFRESHED') && session?.user) {
                        // Deduplicate SIGNED_IN that fires immediately after INITIAL_SESSION for the same user
                        const userId = session.user.id;
                        if ((event === 'SIGNED_IN' || event === 'INITIAL_SESSION') && userId === _lastAuthInitUserId) {
                            console.log(`ðŸ” Auth event deduplicated (already processed for this user): ${event}`);
                            return;
                        }
                        _lastAuthInitUserId = userId;
                        
                        // Use progressive delays: quick retry for INITIAL_SESSION, longer for others
                        const delay = event === 'INITIAL_SESSION' ? 200 : 100;
                        
                        setTimeout(() => {
                            window.initializeAdminSystem().catch(error => {
                                console.error('âŒ Admin initialization failed:', error);
                            });
                        }, delay);
                        
                        // Add additional retry for INITIAL_SESSION to handle edge cases
                        if (event === 'INITIAL_SESSION') {
                            setTimeout(() => {
                                if (window.authManager?.isAuthenticated() && window.adminManager?.isAdmin) {
                                    const adminBtn = document.querySelector('.admin-panel-btn');
                                    if (!adminBtn) {
                                        console.log('âš ï¸ INITIAL_SESSION: Admin Panel button still missing, forcing retry...');
                                        window.adminManager._uiInitialized = false;
                                        window.initializeAdminSystem().catch(error => {
                                            console.error('âŒ INITIAL_SESSION retry failed:', error);
                                        });
                                    }
                                }
                            }, 800);
                        }
                    }
                    
                    // Clean up admin UI when user signs out
                    if (event === 'SIGNED_OUT') {
                        _lastAuthInitUserId = null;
                        window.cleanupAdminUI();
                    }
                });
            };
            
            // Start the early auth listener setup immediately
            setupEarlyAuthListener();
            
            // Initialize template system AFTER editor (requires auth and supabase)
            const initTemplateSystem = () => {
                if (window._templateSystemInitialized) return;
                if (!window.supabaseClient || !window.editor?.authManager) return;

                window._templateSystemInitialized = true;

                // Expose authManager globally for template system
                window.authManager = window.editor.authManager;
                
                window.templateManager = new TemplateManager(window.supabaseClient, window.authManager);
                window.templateImportExport = new TemplateImportExport(window.templateManager);
                window.templateMigration = new TemplateMigration(window.supabaseClient, window.authManager, window.templateManager);
                window.yamlPreviewModal = new YamlPreviewModal();
                window.templateEditor = new TemplateEditor(window.templateManager, window.authManager, window.templateImportExport);
                window.templateWizard = new TemplateWizard(window.templateManager, window.authManager, window.templateImportExport);
                
                // Initialize activity tracker for user activity logging
                window.activityTracker = new ActivityTracker(window.supabaseClient, window.authManager);
                
                // Track login if user is authenticated
                if (window.authManager?.isAuthenticated()) {
                    window.activityTracker.trackLogin('session_init');
                }
                
                // Update global SkillLineBuilder with template dependencies
                if (window.skillLineBuilder) {
                    window.skillLineBuilder.templateManager = window.templateManager;
                    window.skillLineBuilder.templateEditor = window.templateEditor;
                }
                
                // Mark admin system as ready
                window._adminSystemReady = true;
                console.log('âœ… Template system ready, initializing admin system...');
                
                // Always try to initialize, regardless of pending flag
                // This ensures the admin panel appears on first load
                window._pendingAdminInit = false;
                window.initializeAdminSystem().catch(error => {
                    console.error('âŒ Admin system initialization failed:', error);
                });
                
                // Add a retry mechanism to ensure UI is added even if there's a timing issue
                setTimeout(() => {
                    if (window.authManager?.isAuthenticated() && window.adminManager?.isAdmin) {
                        const adminBtn = document.querySelector('.admin-panel-btn');
                        if (!adminBtn) {
                            console.log('âš ï¸ Admin Panel button missing, retrying initialization...');
                            window.adminManager._uiInitialized = false;
                            window.initializeAdminSystem().catch(error => {
                                console.error('âŒ Retry admin system initialization failed:', error);
                            });
                        }
                    }
                }, 500);
                
                // Update any existing SkillBuilderEditor instances with the new dependencies
                if (window.editor.skillEditor?.skillBuilderEditor) {
                    window.editor.skillEditor.skillBuilderEditor.updateTemplateDependencies(
                        window.templateManager, 
                        window.templateEditor
                    );
                }
                if (window.editor.mobEditor?.skillsEditor) {
                    window.editor.mobEditor.skillsEditor.updateTemplateDependencies(
                        window.templateManager,
                        window.templateEditor
                    );
                }
            };

            const waitForTemplateSystemDeps = (attempt = 0) => {
                const maxAttempts = 40; // ~10s with 250ms delay
                if (window.supabaseClient && window.editor?.authManager) {
                    initTemplateSystem();
                    return;
                }

                if (attempt >= maxAttempts) {
                    console.warn('âš ï¸ Template system not initialized: supabaseClient or authManager missing');
                    return;
                }

                setTimeout(() => waitForTemplateSystemDeps(attempt + 1), 250);
            };

            waitForTemplateSystemDeps();
            
            // ==========================================
            // Legal Modal System
            // ==========================================
            
            // Modal open handlers
            document.getElementById('footer-terms-link')?.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('terms-modal-overlay').classList.remove('hidden');
            });
            
            document.getElementById('footer-license-link')?.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('license-modal-overlay').classList.remove('hidden');
            });
            
            document.getElementById('footer-disclaimer-link')?.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('disclaimer-modal-overlay').classList.remove('hidden');
            });
            
            document.getElementById('footer-privacy-link')?.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('privacy-modal-overlay').classList.remove('hidden');
            });
            
            // Modal close handlers - close buttons
            document.querySelectorAll('.legal-modal-close, .legal-modal-close-btn').forEach(btn => {
                let touchHandled = false;
                
                // Touch handler for mobile
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    touchHandled = true;
                    const modalId = btn.getAttribute('data-modal');
                    if (modalId) {
                        document.getElementById(modalId).classList.add('hidden');
                    }
                    setTimeout(() => { touchHandled = false; }, 500);
                }, { passive: false });
                
                // Click handler (skips if touch was handled)
                btn.addEventListener('click', () => {
                    if (touchHandled) return;
                    const modalId = btn.getAttribute('data-modal');
                    if (modalId) {
                        document.getElementById(modalId).classList.add('hidden');
                    }
                });
            });
            
            // Modal close handlers - click/touch on overlay background
            document.querySelectorAll('.legal-modal-overlay').forEach(overlay => {
                let touchHandled = false;
                
                // Touch handler for mobile
                overlay.addEventListener('touchstart', (e) => {
                    if (e.target === overlay) {
                        touchHandled = true;
                        overlay.classList.add('hidden');
                        setTimeout(() => { touchHandled = false; }, 500);
                    }
                }, { passive: true });
                
                // Click handler (skips if touch was handled)
                overlay.addEventListener('click', (e) => {
                    if (touchHandled) return;
                    if (e.target === overlay) {
                        overlay.classList.add('hidden');
                    }
                });
            });
            
            // Modal close handlers - ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.legal-modal-overlay:not(.hidden)').forEach(modal => {
                        modal.classList.add('hidden');
                    });
                }
            });
            
            // ==========================================
            // Dynamic Copyright Year
            // ==========================================
            const copyrightYear = document.getElementById('copyright-year');
            if (copyrightYear) {
                copyrightYear.textContent = new Date().getFullYear();
            }
            
            // ==========================================
            // Service Worker Registration (PWA Support)
            // ==========================================
            // Only register service worker in production (when not on localhost)
            if ('serviceWorker' in navigator && !window.location.hostname.includes('127.0.0.1') && !window.location.hostname.includes('localhost')) {
                window.addEventListener('load', () => {
                    // Use path relative to current location for flexibility
                    const swPath = window.location.pathname.includes('/Soaps-MythicMobs-Editor/') 
                        ? '/Soaps-MythicMobs-Editor/service-worker.js' 
                        : './service-worker.js';
                    
                    navigator.serviceWorker.register(swPath)
                        .then(registration => {
                            console.log('SW registered:', registration.scope);
                            
                            // Check for updates
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        // New version available
                                        if (window.showToast) {
                                            showToast('New version available! Refresh to update.', 'info', 5000);
                                        }
                                    }
                                });
                            });
                        })
                        .catch(err => {
                            // Silently ignore SW errors - PWA is optional
                            if (window.DEBUG_MODE) console.warn('SW registration failed:', err);
                        });
                });
            }
            
            // ==========================================
            // Online/Offline Status Notifications
            // ==========================================
            window.addEventListener('online', () => {
                if (window.showToast) {
                    showToast('You are back online!', 'success', 3000);
                }
            });
            
            window.addEventListener('offline', () => {
                if (window.showToast) {
                    showToast('You are offline. Changes will be saved locally.', 'warning', 5000);
                }
            });
        });
    </script>
</body>
</html>
